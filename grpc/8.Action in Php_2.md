
至于Php下面怎么用……首先，第一步要安装Php（废话）  

接着，要安装Php的grpc扩展（这个不是废话了）  

`https://grpc.io/docs/quickstart/php.html`  

这是官方的教程，不过很遗憾，我的环境是centos，所以要看centos的教程`https://github.com/grpc/grpc/tree/master/src/php#build-from-source`  

不过这教程写得密密麻麻的，看了就让人头晕，实际上我可以完全不管这个教材。  

先到：`https://pecl.php.net/package/gRPC`下载安装包进行安装。  

`wget https://pecl.php.net/get/grpc-1.7.0RC1.tgz`
```
$ cd grpc-1.7.0RC1  
$ phpize
$ ./configure
$ make
$ make install
```

生成出来的扩展grpc.so加入到php扩展中去（这个不用教了吧……不知道的百度一下）  

这样就算是完成了，之后可以写代码测试。在上一节中，我们生成了一批Php的文件。  

```
[root@6c6aa7fb57ef grpc]# ls
GPBMetadata  Redis  index.php  redis.pb.go  redis.proto
[root@6c6aa7fb57ef grpc]# 
```
GPBMetadata  Redis就是生成的两个官方目录，index.php就是我自己手写的。后面两个不用管。  
```php
<?php
include_once "Redis/RedisRequest.php";

echo "hello";
```

然后页面上访问这个index.php  
报错：
```
Fatal error: Class 'Google\Protobuf\Internal\Message' not found in /data/grpc/Redis/RedisRequest.php on line 14
```

看代码，问题出在：  

```php
class RedisRequest extends \Google\Protobuf\Internal\Message
```
上面，这是怎么回事？  

因为还少了个protobuff扩展，官方提供了两种方式：  

1. C implementation (for better performance)
```
$ sudo pecl install protobuf
```

2. PHP implementation (for easier installation)

Add this to your composer.json file:
```
  "require": {
    "google/protobuf": "^v3.3.0"
  }
```

我选择第一种，简单，同样生成了一个扩展文件，按说明加入Php环境中即可  

```
Build process completed successfully
Installing '/usr/lib64/php/modules/protobuf.so'
install ok: channel://pecl.php.net/protobuf-3.4.0
configuration option "php_ini" is not set to php.ini location
You should add "extension=protobuf.so" to php.ini
```

大功告成！  

………………才怪，在写Php代码的时候又出怪问题了。  

第一个问题在于我根据.proto文件生成Php代码的时候，方法错了，我没有启用Php的插件，导致生成的文件不全。  

插件如何安装，根据文档上的说法（老实说这个官方文档真的太复杂了，极不友好）  

`git clone -b $(curl -L https://grpc.io/release) https://github.com/grpc/grpc`  

然后：  
```
$ cd grpc
$ make grpc_php_plugin
```

最后会在这个grpc的目录下面的/bins目录下面产生你所需要的插件：  
```
[root@6c6aa7fb57ef grpc]# cd bins/opt/
grpc_cpp_plugin          grpc_node_plugin         grpc_php_plugin          grpc_ruby_plugin
grpc_csharp_plugin       grpc_objective_c_plugin  grpc_python_plugin       protobuf/
```
如上所示，具体的流程可以参考一下官方的文档，主要是我后来被搞晕了，当中可能有疏忽遗漏的步骤。  

弄好后重新生成Php代码。  


